/*unfold*/
(function ($) {
	"use strict";
	var WidgetPDynamicQviewHandler = function($scope, $) {
		var qvwrap = $scope.find('.tp-quick-view-wrap-dl');
		
		if(qvwrap.length){
			jQuery( document ).ready(function($) {
				$(document).on('click', ".tp-quick-view-wrap-dl", function() {
					event.preventDefault();
					var product_id = $(this).data('product-id'),
					customtemplate = $scope.find('.dynamic-listing').data("customtemplateqcw"),
					template = $scope.find('.dynamic-listing').data("templateqcw"),
					qvquery = $scope.find('.dynamic-listing').data("qvquery");
					
					if(product_id !== undefined){
						jQuery.ajax({
							type: 'POST',
							url: theplus_ajax_url,							
							data :{
								'action': 'tp_get_dl_post_info_ajax',
								'product_id':  product_id,
								'custom_template':  customtemplate,
								'template_id' : template,
								'qvquery' : qvquery,
								'status': 'publish',
								'security' : theplus_nonce,			 
							}, 
							success:function(response){	
								$.fancybox.open(response);
								$('.tp-dl-view-spinner').remove();
								$('.tpdlqactive').css('display','block').removeClass('tpdlqactive');								
							}
						});
					}
					
					$(this).find('i').addClass('tpdlqactive').css('display','none');
					$(this).append('<div class="tp-dl-view-spinner"></div>');
				});
			});
		}
	};	
	
	$(window).on('elementor/frontend/init', function () {
		elementorFrontend.hooks.addAction('frontend/element_ready/tp-dynamic-listing.default', WidgetPDynamicQviewHandler);
	});
})(jQuery);