(function(t){"use strict";t(".ShareoneDrive").on("shareonedrive-loaded",function(e,o){t(this).hasClass("carousel")&&t(this).WPCP_ShareoneDrive_Carousel(o.options)})})(jQuery),function(t){"use strict";t.widget("cp.WPCP_ShareoneDrive_Carousel",{options:{listtoken:null},_create:function(){this.options.topContainer=this.element.parent(),this.options.mainContainer=this.element.find(".wpcp-carousel"),this.options.loadingContainer=this.element.find(".loading"),this.options.carouselContainer=this.element.find(".wpcp-carousel-main-container"),this.options.slideTemplate=this.element.find(".wpcp-carousel-item-template .wpcp-carousel-item"),this.options.listtoken=this.element.attr("data-token"),this.options.account_id=this.element.attr("data-account-id"),this.options.drive_id=this.element.attr("data-drive-id"),this.images={},this.images_total=0,this.carousel=!1;let t=parseFloat(this.options.carouselContainer.attr("data-items"));this.options.carousel={container:this.options.carouselContainer.get(0),autoWidth:"horizontal"===this.options.carouselContainer.attr("data-axis")&&"1"===this.options.carouselContainer.attr("data-auto-size"),autoHeight:"vertical"===this.options.carouselContainer.attr("data-axis")&&"1"===this.options.carouselContainer.attr("data-auto-size"),mode:"carousel",axis:this.options.carouselContainer.attr("data-axis"),items:1,slideBy:1,edgePadding:0,gutter:0,loop:!0,center:!1,speed:parseInt(this.options.carouselContainer.attr("data-speed")),controls:"1"===this.options.carouselContainer.attr("data-navigation-arrows"),controlsPosition:"bottom",controlsText:['<i class="eva eva-chevron-left"></i>','<i class="eva eva-chevron-right"></i>'],autoplay:"1"===this.options.carouselContainer.attr("data-autoplay"),autoplayDirection:this.options.carouselContainer.attr("data-autoplayDirection"),autoplayHoverPause:"1"===this.options.carouselContainer.attr("data-autoplayHoverPause"),autoplayTimeout:parseInt(this.options.carouselContainer.attr("data-autoplayTimeout")),autoplayText:["▶","❚❚"],autoplayButtonOutput:!1,nav:!1,navPosition:"bottom",arrowKeys:!0,mouseDrag:!0,swipeAngle:!1,responsive:{630:{items:t<2?1:2,slideBy:t<2?1:2,gutter:"0"===this.options.carouselContainer.attr("data-auto-size")?this.options.carouselContainer.attr("data-gutter"):1,nav:"1"===this.options.carouselContainer.attr("data-nav"),mouseDrag:!0,center:"1"===this.options.carouselContainer.attr("data-center")},900:{slideBy:parseFloat(this.options.carouselContainer.attr("data-slideBy"))<=t?parseFloat(this.options.carouselContainer.attr("data-slideBy")):t,items:t}}},this._initiate()},_destroy:function(){return this._super()},_setOption:function(t,e){this._super(t,e)},_initiate:function(){let t=this;t.options.topContainer.one("inview",function(e,o){t.load()})},load:function(){let t=this;var e=t.buildRequest();e({},t)},_initCarousel:function(e){var o=this;if(!1===e)return o.options.mainContainer.find(".wpcp-carousel-preloading").remove(),void o.showError();t.isEmptyObject(e)?o.showError():(o.images_total=e.total,o.addImages(e.images),o.options.carousel.responsive[900].items>o.images_total&&(o.options.carousel.responsive[900].items=o.images_total,o.options.carousel.responsive[630].items=o.images_total<2?1:2),o.carousel=tns(o.options.carousel),o.carousel.events.on("indexChanged",function(e,i){let a=e.index-e.items<0?0:e.index-e.items,n=Array.prototype.slice.call(e.slideItems,a,e.index+2*e.items);o._fetchImages(t(n).find(".wpcp-carousel-item-bg[data-src]"))}),o.carousel.events.emit("indexChanged",o.carousel.getInfo()),o.options.mainContainer.addClass("wpcp-carousel-loaded"),o.options.mainContainer.find(".wpcp-carousel-preloading").remove(),o.setEvents())},setEvents:function(){let e=this;t(e.options.carouselContainer).on({click:function(o){var i=t(this).parents(".wpcp-carousel-item");return o.stopPropagation(),e.options.main._actionDownloadEntry(i,o)}},".entry_action_download"),t(e.options.carouselContainer).on({click:function(o){var i=t(this).parents(".wpcp-carousel-item");o.stopPropagation(),e.options.main._actionShareEntry(i,o)}},".entry_action_shortlink");let o=e.options.carouselContainer[0].querySelectorAll(".entry-description-button");t(o).on("click",function(t){t.stopPropagation()}),tippy(o,{trigger:"mouseenter focus click",arrow:!1,offset:0,content:function(t){return t.querySelector(".tippy-content-holder").innerHTML},maxWidth:350,allowHTML:!0,placement:"bottom",delay:[100,null],offset:[0,0],interactiveBorder:15,appendTo:e.element[0],moveTransition:"transform 0.2s ease-out",interactive:!0,onShow:function(t){tippy.hideAll()},onHide:function(t){}})},buildRequest:function(){let t=this;var e=e=>{t._initCarousel(e)};return t.options.main._pipeline({url:ShareoneDrive_vars.ajax_url,type:"POST",dataType:"json",data:function(e){return e.action="shareonedrive-get-gallery",e.type="carousel",e.account_id=t.options.account_id,e.drive_id=t.options.drive_id,e.listtoken=t.options.listtoken,e.id=t.element.attr("data-id"),e._ajax_nonce=ShareoneDrive_vars.gallery_nonce,e}},e)},addImages:function(e){let o=this;const i=Math.round(t(".wpcp-carousel").height()-20),a=Math.round(t(".wpcp-carousel").width());t.each(e,function(){var t=this;let e=o.options.slideTemplate.clone(),n=e.find(".wpcp-carousel-item-bg").get(0);n.setAttribute("data-src",t.url),e.attr("data-id",t.id).attr("data-name",t.name),o.options.carousel.autoWidth&&e.children().first().css({width:t.width&&t.height?Math.round(i*t.width/t.height):i,height:i}),o.options.carousel.autoHeight&&e.children().first().css({width:a,height:t.width&&t.height?Math.round(a*t.height/t.width):a}),e.find(".wpcp-carousel-item-date span").text(t.last_edited_time_str),e.find(".wpcp-carousel-item-title span").html(t.name),t.description?(e.find(".wpcp-carousel-item-description, .description-text").html(t.description),e.addClass("wpcp-has-description")):e.find(".wpcp-carousel-item-description").remove(),t.download_url&&e.find(".entry_action_download").attr("href",t.download_url),o.images[t.id]=e,o.options.carouselContainer.append(e)})},_fetchImages:function(e){var o=this;t.each(e,function(){t(this).css({"background-image":'url("'+t(this).attr("data-src")+'")'}),t(this).addClass("wpcp-carousel-item-bg-loading")});let i=imagesLoaded(o.options.carouselContainer.get(0),{background:".wpcp-carousel-item-bg-loading"});i.on("progress",function(e,o){var i=o.isLoaded?"loaded":"broken";let a=t(o.element);a.removeClass("wpcp-carousel-item-bg-loading"),"broken"!==i&&(a.removeClass("preloading").removeAttr("data-src"),a.prev(".preloading").remove(),a.css("opacity",1),a.parents(".wpcp-carousel-item").find(".wpcp-carousel-item-overlay").addClass("wpcp-visible"),a.parents(".wpcp-carousel-item").find(".wpcp-carousel-item-text").css("opacity",1))})},showError:function(){let t=this;t.options.carouselContainer.html('<p style="text-align:center;">'+t.options.str_no_filelist+"</p>")}})}(jQuery);