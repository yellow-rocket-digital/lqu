(function(e){"use strict";function t(t){s=t,e("#wpcp").attr("data-mode","wpcp-module-"+s),e("#wpcp .wpcp-module-classes[data-nav-tab]").not(".wpcp-module-all").attr("disabled","disabled").addClass("disabled"),e("#wpcp .wpcp-module-classes[data-nav-tab].wpcp-module-"+s).attr("disabled","").removeClass("disabled"),e("#wpcp [data-nav-panel] .wpcp-module-classes").not(".wpcp-module-all").addClass("hidden"),e("#wpcp [data-nav-panel] .wpcp-module-classes.wpcp-module-"+s).not(".wpcp-module-all").removeClass("hidden"),e("[data-nav-panel]").each(function(){e(this).find(".wpcp-panel:not(.hidden) .wpcp-panel-header").first().trigger("click")}),"files"===t||("upload"===t?e('input[name="upload"]').prop("checked",!0).trigger("change"):"gallery"===t||("audio"===t?e('input[name="singleaccount"]').prop("checked",!0).trigger("change"):"video"===t&&e('input[name="singleaccount"]').prop("checked",!0).trigger("change")))}function a(e){var t=o();e.preventDefault(),!1!==t&&n(t)}function n(t){window.top.postMessage({slug:"shareonedrive",action:"wpcp-shortcode",shortcode:t},window.location.origin);var a=e("form").data("callback");""!==a&&window.parent[a](t)}function o(){var t=e(".wpcp-module-all").find('input[type="text"], input[type="number"], input[type="checkbox"], input[type="radio"]:checked, option:selected'),a=e(".wpcp-module-"+s).find('input[type="text"], input[type="number"], input[type="checkbox"], input[type="radio"]:checked, option:selected');t=t.add(a);var n=t.filter(function(){var t=e(this);return e.inArray(t.attr("name"),["mode","viewrole"])>=0||!t.hasClass("wpcp-folder-selector-current")&&((!1!==t.closest(".wpcp-module-classes").hasClass("wpcp-module-"+s)||!1!==t.closest(".wpcp-module-classes").hasClass("wpcp-module-all"))&&((!t.parents(".wpcp-toggle-panel").length||"none"!==t.parents(".wpcp-toggle-panel").css("display"))&&d(t)!=p(t)))}),o="[shareonedrive ",i=[];for(var r in i.mode=d(e('input[name="mode"]')),"1"===d(e('input[name="singleaccount"]'))&&(i.dir=d(e('input[name="dir[id]"]')),i.account=d(e('input[name="dir[account]"]')),i.drive=d(e('input[name="dir[drive]"]'))),"manual"===d(e('input[name="userfolders"]:checked'))&&(delete i.account,delete i.dir,delete i.drive),n.each(function(){e(this).is("option")?i[e(this).parent().attr("name")]=d(e(this)):i[e(this).attr("name")]=d(e(this))}),"download"in i&&(delete i.download,i.downloadrole="none"),"preview"in i&&(delete i.preview,i.previewrole="none"),"use_usertemplatedir"in i&&(delete i.use_usertemplatedir,i.usertemplatedir=d(e('input[name="usertemplatedir[id]"]'))),"userfoldernametemplate"in i&&""==i.userfoldernametemplate&&delete i.userfoldernametemplate,"upload"==i.mode&&"editdescription"in i&&(i.upload_auto_start="0"),i)o+=r+'="'+i[r]+'" ';return o+="]",e("#wpcp-raw-shortcode-preview").val(o),o}function i(t){e("input[name='showplaylist']").prop("checked",!1).trigger("change"),e("input[name='include']").val(t.data("id"));var a=t.find(".entry_link:first").data("name"),i=["mp4","m4v","ogg","ogv","webmv"],d=["mp3","m4a","oga","wav","webm"];d.forEach(function(t){if(a.indexOf("."+t)>=0)return e("input#mode-audio").trigger("click"),!1}),i.forEach(function(t){if(a.indexOf("."+t)>=0)return e("input#mode-video").trigger("click"),!1});var p=o();!1!==p&&n(p)}function d(e){return e.hasClass("wpcp-tagify")?l(e):"checkbox"===e.attr("type")?e.parents("fieldset").length?c(e.parents("fieldset")):e.prop("checked")?"1":"0":"radio"===e.attr("type")?e.data("value"):"number"===e.attr("type")?""!==e.val()?e.val():e.data("default-value"):e.val()}function p(e){return e.is("option")?e.parent().data("default-value"):"checkbox"===e.attr("type")?e.parents("fieldset").length?e.parents("fieldset").data("default-value"):"true"===e.data("default-value")||1==e.data("default-value")?"1":"0":"radio"===e.attr("type")?e.parents("fieldset").data("default-value"):e.data("default-value")}function r(t){var a=t.find(":checked").map(function(){return e(this).data("value")}).get();return a}function c(e){var t=r(e);return 0===t.length?"none":t.length===e.length?"all":t.join("|")}function l(t){var a=t.val();if(0===a.length)return"none";var n=[];return e.each(JSON.parse(a),function(e,t){n.push(t.id)}),n.indexOf("none")>-1?"none":n.indexOf("all")>-1?"all":n.join("|")}var s;e("#wpcp").on({change:function(){t(e(this).data("value"))}},'input[name="mode"]'),e('#wpcp input[name="mode"]:checked').trigger("change"),e('input[name="upload"]').on({change:function(){!0===e(this).prop("checked")?e('[data-nav-tab="wpcp-upload"]').attr("disabled","").removeClass("disabled"):e('[data-nav-tab="wpcp-upload"]').attr("disabled","disabled").addClass("disabled")}}).trigger("change"),"upload-field"===e("#wpcp form").data("configuration")&&e('input[name="mode"]').not("#mode-files, #mode-upload").prop("disabled",!0).parent().parent().hide(),""!==e('input[name="usertemplatedir[id]"]').val()&&e('input[name="use_usertemplatedir"]').prop("checked",!0).trigger("change"),e('input[name="userfolders"]').on({change:function(){"manual"===d(e('input[name="userfolders"]:checked'))?e('[data-nav-tab="wpcp-content"]').attr("disabled","disabled").addClass("disabled"):e('[data-nav-tab="wpcp-content"]').attr("disabled","").removeClass("disabled")}}).trigger("change"),e(".wpcp-module").on("wpcp-content-loaded",function(e,t){var a=t.element.parents(".wpcp-folder-selector");a.length&&(a.find(".wpcp-folder-selector-input-name, .wpcp-folder-selector-current").val(t.raw_path),a.find(".wpcp-folder-selector-input-account").val(t.element.attr("data-account-id")),a.find(".wpcp-folder-selector-input-drive").val(t.element.attr("data-drive-id")),a.find(".wpcp-folder-selector-input-id").val(t.element.attr("data-id")))}),e(".wpcp-module").one("ajax-error",function(){e('[data-nav-tab="wpcp-content"]').trigger("click"),e("#wpcp-modal-missing-content").fadeIn()}),e("#wpcp").on({click:function(e){a(e)}},"#wpcp-button-save-shortcode"),e(".wpcp-module").on({click:function(t){t.stopPropagation(),i(e(this).closest(".entry"))}},".entry-embed-item"),e("#wpcp").on({click:function(t){o(),e(e(this).data("dialog-id")).fadeIn()}},"#wpcp-button-create-shortcode"),e("#wpcp").on({click:function(t){var a=e("<input>");e("body").append(a),a.val(e("#wpcp-raw-shortcode-preview").val()).select(),document.execCommand("copy"),a.remove()}},"#wpcp-copy-raw-shortcode"),e("#wpcp").on({click:function(t){e(this).prop("disabled",!0).addClass("disabled");let a=e("#wpcp-raw-shortcode-preview").val();a=a.replace("[shareonedrive ","").replace('"]',"");let n=encodeURIComponent(a).split("%3D%22").join("=").split("%22%20").join("&"),o=new URL(window.location);var i=new URLSearchParams(o.search);window.location.href=ShareoneDrive_vars.ajax_url+"?action=shareonedrive-getpopup&type="+i.get("type")+"&callback="+i.get("callback")+"&"+n}},"#wpcp-button-import-shortcode"),e("#enjoying-button-lets-ask-no").on("click",function(t){e(".enjoying-container.lets-ask").fadeOut("fast",function(){e(".enjoying-container.mwah").fadeIn()})}),e("#enjoying-button-lets-ask-yes").on("click",function(t){e(".enjoying-container.lets-ask").fadeOut("fast",function(){e(".enjoying-container.go-for-it").fadeIn()})}),e("#enjoying-button-mwah-no, #enjoying-button-go-for-it-no, #enjoying-button-go-for-it-yes, #enjoying-button-mwah-yes").click(function(){e.ajax({type:"POST",url:ShareoneDrive_vars.ajax_url,data:{action:"shareonedrive-rating-asked"}})})})(jQuery);